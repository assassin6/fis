define(function(e,s,i){var t=e("ms"),a="image",l="file",n="all",o={image:{title:"Image files",extensions:"jpg,JPG,jpeg,PNG,gif,png"},file:{title:"Zip files",extensions:"ZIP,zip,DOC,doc,docx,xls,XLS,xlsx,RAR,rar"},video:{title:"video files",extensions:"MP3,MP4"},all:{title:"all files",extensions:"jpg,JPG,jpeg,PNG,gif,png,ZIP,zip,DOC,doc,docx,xls,XLS,xlsx,RAR,rar"}},r={image:"<div><img /><span>删除</span></div>",file:"<div><b></b><span>删除</span></div>",all:"<div><b></b><span>删除</span></div>",video:"<div><b></b><span>删除</span></div>",input:"<input type='hidden' value />"},p={init:function(e,s,i,p){function d(e){t.isEmpty(e.type)||(m.type=e.type),t.isEmpty(e.size)||(m.size=e.size),t.isEmpty(e.single+"")||(m.single=e.single),t.isEmpty(e.domClass)||(m.domClass=e.domClass),t.isEmpty(e.beforeMsg)||(m.beforeMsg=e.beforeMsg),t.isEmpty(e.afterMsg)||(m.afterMsg=e.afterMsg),t.isEmpty(e.afterDom)||(m.afterDom=e.afterDom)}var f,m={url:t.base+"/upload",type:"image",size:500,single:!0,domClass:"",beforeMsg:"上传中...",afterMsg:"更换"};f=$("#"+e),t.isJson(p)&&d(p);var g=new plupload.Uploader({browse_button:e,url:m.url,flash_swf_url:"js/Moxie.swf",silverlight_xap_url:"js/Moxie.xap",multi_selection:m.single,multipart_params:{uploadPath:i},filters:{mime_types:[o[m.type]],max_file_size:m.size+"kb"}});g.init(),g.bind("FileFiltered",function(e,s){f.attr("disabled",!0),"button"==f.type?f.val(m.beforeMsg):f.html(m.beforeMsg),e.start()}),g.bind("FileUploaded",function(e,i,o){f.attr("disabled",!1),"button"==f.type?f.val(m.afterMsg):f.html(m.afterMsg),"show"==m.afterDom?f.show():"hide"==m.afterDom&&f.hide();var d=$(r[m.type]),g=$(r.input);f.prev("div").remove(),d.addClass(m.domClass),m.type==a?d.find("img").attr("src",t.base+o.response):d.find("b").text(m.type==l?i.name:m.type==n?i.name:i.name),g.attr("name",s),g.val(o.response),f.before(g),f.before(d),d.find("span").click(function(){f.prev("div").remove(),g.remove(),f.show()}),t.isJson(p.success)||p.success(i)}),g.bind("Error",function(e,s){-600==s.code?t.alert("文件过大"):-700==s.code&&t.alert("图片格式错误")})},Destroy:function(e){}};i.exports=p});