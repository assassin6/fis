define(function(require,exports,module){var ms=require("ms");return{version:"1.0.0",toPay:function(e){var t=e.orderNo,r=e.orderName,a=e.orderDesc,n=e.orderPrice,o=e.payPage,i=$('<form style="display:none"></form>').attr("method","post").attr("target","_self");i.attr("action",ms.base+"/bank/pay/gateway.do"),i.append($('<input type="text" name="orderNo" />').attr("value",t)),i.append($('<input type="text" name="orderName" />').attr("value",r)),i.append($('<input type="text" name="orderDesc" />').attr("value",a)),i.append($('<input type="text" name="orderPrice" />').attr("value",n)),i.append($('<input type="text" name="page" />').attr("value",o)),$.post(ms.base+"/bank/pay/gateway.do",i.serialize(),function(e){e.result?location.href=e.resultMsg:alert("发起支付失败！")})},pay:function(json){function onBridgeReady(){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:json.appId,timeStamp:json.timeStamp,nonceStr:json.nonceStr,"package":"prepay_id="+json["package"],signType:"MD5",paySign:json.paySign},function(res){"get_brand_wcpay_request:ok"==res.err_msg?(alert("支付成功"),success&&eval(success())):"get_brand_wcpay_request:ok"==res.err_msg||alert("支付异常"+JSON.stringify(res))})}function checkOrder(){$.post(ms.base+"/people/order/detail.do",{orderNo:orderNo,orderStatus:2},function(data){data&&(console.log(data),success&&eval(success()),window.clearInterval(check))})}var type=json.type,orderNo=json.orderNo,orderName=json.orderName,orderDesc=json.orderDesc,orderPrice=json.orderPrice,returnUrl=json.returnUrl,showUrl=json.showUrl,success=json.success;if("weixin"==type){if(!this.isWeixin())return void alert("请在微信里访问该页面！");"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",onBridgeReady,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",onBridgeReady),document.attachEvent("onWeixinJSBridgeReady",onBridgeReady)):onBridgeReady()}else if("weixinQr"==type){var target=json.target,width=json.width,height=json.height,qrcode=json.qrcode;$(target).attr("src",ms.base+"/qrcode?contents="+qrcode+"&width="+width+"&height="+height);var check=window.setInterval(checkOrder,1e3)}else if("alipay"==type){var form=$('<form style="display:none"></form>').attr("method","post").attr("target","_blank");form.attr("action",ms.base+"/bank/alipay/pay.do"),form.append($('<input type="text" name="orderNo" />').attr("value",orderNo)),form.append($('<input type="text" name="orderName" />').attr("value",orderName)),form.append($('<input type="text" name="orderDesc" />').attr("value",orderDesc)),form.append($('<input type="text" name="orderPrice" />').attr("value",orderPrice)),form.append($('<input type="text" name="returnUrl" />').attr("value",returnUrl)),form.append($('<input type="text" name="showurl" />').attr("value",showUrl)),form.append($('<input type="text" name="notifyUrl" value="'+ms.base+'/bank/alipay/notify.do" />')),$(document.body).append(form),form.submit()}},isWeixin:function(){var e=window.navigator.userAgent.toLowerCase();return"micromessenger"==e.match(/MicroMessenger/i)}}});